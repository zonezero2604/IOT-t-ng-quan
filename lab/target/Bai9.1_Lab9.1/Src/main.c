/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2022 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include <led.h>
#include "stm32f401re_gpio.h"
#include "stm32f401re_tim.h"

void LedSetColor(uint8_t led_id, uint8_t led_color, uint8_t led_level);
int main(void) {
	LedControl_Init();
	/* Điều khiển led trên kit mở rộng màu đỏ với cường độ sáng là 0% */
	LedSetColor(LED_KIT_ID0, LED_COLOR_RED, 0);
	/* Loop forever */
	while (1) {
		/* Bật led màu xanh trên kit mở rộng với cường độ sáng là 20% */
		LedSetColor(LED_KIT_ID0, LED_COLOR_RED, 20);
	}
}

void LedSetColor(uint8_t led_id, uint8_t led_color, uint8_t led_level) {
	uint32_t channelPulse;
	if ((led_id >= NUM_OF_LED) || !isTypeLED(led_color) || (led_level > 100))
		return;

	channelPulse = (((uint32_t) led_level * (LED_TIMER_PERIOD - 1)) / 100);

	if (led_id == LED_BOARD_ID) {
		if (led_level != 0) {
			GPIO_SetBits(LED_BOARD_PORT, LED_BOARD_PIN);
		} else {
			GPIO_ResetBits(LED_BOARD_PORT, LED_BOARD_PIN);
		}
	} else if (led_id == LED_KIT_ID0) {
		if (led_color == LED_COLOR_RED) {
			TIM_SetCompare1(TIM1, channelPulse);
		} else if (led_color == LED_COLOR_GREEN) {
			TIM_SetCompare4(TIM1, channelPulse);
		} else /* (led_color == LED_COLOR_BLUE) */
		{
			TIM_SetCompare3(TIM1, channelPulse);
		}
	} else /* (led_id == LED_KIT_ID1) */
	{
		if (led_color == LED_COLOR_RED) {
			TIM_SetCompare2(TIM2, channelPulse);
		} else if (led_color == LED_COLOR_GREEN) {
			TIM_SetCompare1(TIM2, channelPulse);
		} else /* (led_color == LED_COLOR_BLUE) */
		{
			TIM_SetCompare4(TIM2, channelPulse);
		}
	}

}

